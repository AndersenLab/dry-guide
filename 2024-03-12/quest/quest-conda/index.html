<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Conda - Andersen Lab Dry Guide</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Conda";
        var mkdocs_page_input_path = "quest/quest-conda.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Andersen Lab Dry Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Overview</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Knowledge Base</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../knowledge_base/best_practices/">Best Practices</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../knowledge_base/r/">R</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../knowledge_base/shiny/">R Shiny</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../knowledge_base/bash/">Command Line</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../knowledge_base/github/">Git and Github</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Rockfish</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../rockfish/rf-intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rockfish/VAST/">Data on Rockfish</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rockfish/rf-conda/">Conda</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../rockfish/rf-nextflow/">Nextflow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Quest</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../quest-intro/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../b1059/">Data on b1059</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Conda</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#why_conda">Why Conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting_up_conda_on_quest">Setting up Conda on Quest</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using_conda">Using Conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running_nextflow_with_conda">Running Nextflow with conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#notes_on_conda_versions_on_quest">Notes on conda versions on Quest</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quest-nextflow/">Nextflow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Nextflow Pipelines</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >WI Sequencing pipelines</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-trimming/">trim-fq-nf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-alignment/">alignment-nf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-wiGATK/">wi-gatk</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-concordance/">concordance-nf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-postGATK/">post-gatk-nf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-impute/">imputation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-annotation-nf/">annotation-nf</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Other pipelines</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-nemascan/">NemaScan</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-cellprofiler/">Image Analysis</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-nil-ril/">nil-ril-nf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../pipelines/pipeline-genomes-nf/">genomes-nf</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../pipelines/docker/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../pipelines/nf-GCPconfig/">GCP</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other things</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/caendr/">CeNDR</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/backup/">Backup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/sra/">SRA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/cloud/">Cloud</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/sharing-globus/">Globus file sharing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/writing-nextflow/">Writing Nextflow workflows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/labsite/">Andersen Labsite</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Andersen Lab Dry Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Quest</li>
      <li class="breadcrumb-item active">Conda</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Andersenlab/dry-guide/edit/master/docs/quest/quest-conda.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="using_conda_on_quest">Using conda on Quest<a class="headerlink" href="#using_conda_on_quest" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#using_conda_on_quest">Using conda on Quest</a><ul>
<li><a href="#why_conda">Why Conda</a></li>
<li><a href="#setting_up_conda_on_quest">Setting up Conda on Quest</a></li>
<li><a href="#using_conda">Using Conda</a></li>
<li><a href="#running_nextflow_with_conda">Running Nextflow with conda</a></li>
<li><a href="#notes_on_conda_versions_on_quest">Notes on conda versions on Quest</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="why_conda">Why Conda<a class="headerlink" href="#why_conda" title="Permanent link">&para;</a></h2>
<p><strong>Computational Reproducibility</strong> is the ability to reproduce an analysis exactly. In order for computational research to be reproducible you need to keep track of the code, software, and data. We keep track of code using git and GitHub (for help, see the <a href="../../knowledge_base/github/">Github page</a>). Our starting data (usually FASTQs) is almost always static, so we don't need to track changes to the data. We perform a new analysis when data is added.</p>
<p>To track software, package and environment managers such as Conda and Docker are very useful. Conda works similarly to <a href="https://brew.sh/">brew</a> or <a href="https://github.com/pyenv/pyenv">pyenv</a> that were used in the legacy Andersen-Lab-Env. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The software environments on Mac and Linux are not exactly identical...but they are very close.</p>
</div>
<h2 id="setting_up_conda_on_quest">Setting up Conda on Quest<a class="headerlink" href="#setting_up_conda_on_quest" title="Permanent link">&para;</a></h2>
<p>Anaconda is a Python distribution that contains many packages including conda. Miniconda is a more compact version of Anaconda that also includes conda. So in order to install conda, we usually either install Miniconda or Anaconda. On Quest, Anaconda is already installed. However there are many versions of Anaconda, each can have a different version of Python and Conda. The current lab environments mainly used <code>module load python/anaconda3.6</code> (See <strong>Notes</strong> below for more info).</p>
<p>In your home directory <code>~/</code>, create a file called <code>.condarc</code> and put the following lines into it. It sets the channel priority when conda searches for packages. If possible, in one environment it is good to use packages from the same channel. </p>
<pre><code>channels:
    - conda-forge
    - bioconda
    - defaults

auto_activate_base: false

envs_dirs:
    - ~/.conda/envs/
    - /projects/b1059/software/conda_envs/
</code></pre>
<h2 id="using_conda">Using Conda<a class="headerlink" href="#using_conda" title="Permanent link">&para;</a></h2>
<p><strong><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/index.html">Conda Documentation</a></strong></p>
<p><strong><a href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf">Conda Cheatsheet</a></strong></p>
<p>After loading the Anaconda module, one can create an environment and install packages into that environment:</p>
<pre><code># Create conda environment named &quot;name_of_env&quot;
conda create --name name_of_env

# Create conda environment in a specific folder
conda create -p /projects/b1059/software/conda_envs/test

# activate conda environment
# for some `conda activate` works and for others `source activate`
conda activate test
source activate test

# install package into conda environment
conda install bcftools
</code></pre>
<p>When looking to install a package, one resource to check out is <a href="https://anaconda.org">anaconda.org</a>, search for your package and run the install command listed on the page.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to keep in mind the different versions of software/packages. You could have bcftools-v1.10 or bcftools-v.1.12, so make sure you install the correct one!</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can also install R packages with conda, however conda and R don't always work well together. Check out our quick fix <a href="../../knowledge_base/r/">here</a></p>
</div>
<h2 id="running_nextflow_with_conda">Running Nextflow with conda<a class="headerlink" href="#running_nextflow_with_conda" title="Permanent link">&para;</a></h2>
<p>When running Nextflow, conda environments can be specified as part of a process or in the <code>nextflow.config</code> file to apply to the entire pipeline (check out the <a href="https://www.nextflow.io/docs/latest/conda.html">documentation</a>):</p>
<p><strong>Conda within a process:</strong></p>
<pre><code>process foo {
    conda '/projects/b1059/software/conda_envs/cegwas2-nf_env'

    '''
    your_command --here
    '''
}
</code></pre>
<p><strong>Conda for the entire pipeline:</strong></p>
<pre><code>// in the nextflow.config file:
conda { 
        conda.enabled = true 
        conda.cacheDir = &quot;.env&quot;  
}

process {
        conda = &quot;/projects/b1059/software/conda_envs/cegwas2-nf_env&quot;
}
</code></pre>
<h2 id="notes_on_conda_versions_on_quest">Notes on conda versions on Quest<a class="headerlink" href="#notes_on_conda_versions_on_quest" title="Permanent link">&para;</a></h2>
<p><strong>tl;dr;</strong> If having trouble with conda, or Nextflow gives conda-related errors, try to load a different version of anaconda on Quest. At some point it may be worth re-creating all conda environments in the lab with a consistent version of conda. </p>
<p>As of the end of 2020, existing conda environments for the lab were mostly created by <code>module load python/anaconda</code> (which got automatically loaded with <code>module git</code> by accident). It loads Python version 2.7.18 and conda 4.5.2. The other environments were created with <code>module load python/anaconda3.6</code> which loads Python 3.6.0 and conda 4.3.30. To see versions, use <code>conda info</code> or <code>conda -V</code>.</p>
<p>Once you activate an environment with <code>conda activate env_name</code> or <code>source activate env_name</code>, the default conda usually get re-directed to the conda that were originally used to create the environment. This is good because it helps ensure that all packages in the same environment uses the same version of conda. One can go to <code>cd ~/.conda/env_name/bin</code> and <code>readlink -f conda</code> or <code>readlink -f activate</code> to see which version of conda is used by this environment. This is exactly how Nextflow determines which conda to use when using an existing conda environment. </p>
<p>Quest people recommended <code>module load python-anaconda3</code>, but that version does not mix well with the versions mentioned above. But if one were to re-install all environments we have, this is probably the version to stick to. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../b1059/" class="btn btn-neutral float-left" title="Data on b1059"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../quest-nextflow/" class="btn btn-neutral float-right" title="Nextflow">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Andersenlab/dry-guide" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../b1059/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../quest-nextflow/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
      <script src="../../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
