<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>wi-gatk - Andersen Lab Dry Guide</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/version-select.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "wi-gatk";
    var mkdocs_page_input_path = "pipeline-wiGATK.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Andersen Lab Dry Guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Knowledge Base</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../bash/">Bash</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../r/">R</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../github/">Git and Github</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Quest</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../quest-intro/">Introduction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../quest-nextflow/">Nextflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-GCPconfig/">GCP</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../quest-conda/">Conda</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-docker/">Docker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../quest-mount/">Mounting Quest</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Pipelines</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-trimming/">trim-fq-nf</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-alignment/">alignment-nf</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-concordance/">concordance-nf</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">wi-gatk</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-postGATK/">post-gatk-nf</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-genomes-nf/">genomes-nf</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-nil-ril/">nil-ril-nf</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../adding-seq-data/">Adding NILs Sequencing Data</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline-cegwas/">cegwas2-nf</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Other things</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../cendr/">CeNDR</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../cloud/">Cloud</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../labsite/">Andersen Labsite</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Andersen Lab Dry Guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Pipelines &raquo;</li>
        
      
    
    <li>wi-gatk</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Andersenlab/dry-guide/edit/master/docs/pipeline-wiGATK.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="wi-gatk">wi-gatk<a class="headerlink" href="#wi-gatk" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#wi-gatk">wi-gatk</a></li>
<li><a href="#pipeline_overview">Pipeline Overview</a><ul>
<li><a href="#software_requirements">Software Requirements</a></li>
</ul>
</li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#profiles">Profiles</a></li>
<li><a href="#running_the_pipeline_locally">Running the pipeline locally</a></li>
<li><a href="#debugging_the_pipeline_on_quest">Debugging the pipeline on Quest</a></li>
<li><a href="#running_the_pipeline_on_quest">Running the pipeline on Quest</a></li>
</ul>
</li>
<li><a href="#parameters">Parameters</a><ul>
<li><a href="#--sample_sheet">--sample_sheet</a><ul>
<li><a href="#--bam_location_optional">--bam_location (optional)</a></li>
<li><a href="#--species_optional">--species (optional)</a></li>
<li><a href="#--project_optional">--project (optional)</a></li>
<li><a href="#--ws_build_optional">--ws_build (optional)</a></li>
<li><a href="#--reference_optional">--reference (optional)</a></li>
<li><a href="#--mito_name_optional">--mito_name (optional)</a></li>
<li><a href="#--output_optional">--output (optional)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#output">Output</a></li>
<li><a href="#data_storage">Data Storage</a><ul>
<li><a href="#cleanup">Cleanup</a></li>
</ul>
</li>
</ul>
</div>
<p>The <code>wi-gatk</code> pipeline filters and calls variants from wild isolate sequence data.</p>
<h1 id="pipeline_overview">Pipeline Overview<a class="headerlink" href="#pipeline_overview" title="Permanent link">&para;</a></h1>
<pre><code>
    _______ _______ _______ __  __      _______ _______ 
    |     __|   _   |_     _|  |/  |    |    |  |    ___|
    |    |  |       | |   | |     &lt;     |       |    ___|
    |_______|___|___| |___| |__|\\__|    |__|____|___|    


    parameters                 description                           Set/Default
    ==========                 ===========                           ========================
    --debug                    Use --debug to indicate debug mode    null
    --output                   Release Directory                     WI-{date}
    --sample_sheet             Sample sheet                          null
    --bam_location             Directory of bam files                /projects/b1059/data/{species}/WI/alignments/
    --mito_name                Contig not to polarize hetero sites   MtDNA

    Reference Genome
    --------------- 
    --reference_base           Location of ref genomes               /projects/b1059/data/{species}/genomes/
    --species/project/build    These 4 params form --reference       {species} / {project} / {ws_build}

    Variant Filters         
    ---------------           
    --min_depth                Minimum variant depth                 5
    --qual                     Variant QUAL score                    30
    --strand_odds_ratio        SOR_strand_odds_ratio                 5
    --quality_by_depth         QD_quality_by_depth                   20
    --fisherstrand             FS_fisher_strand                      100
    --high_missing             Max % missing genotypes               0.95
    --high_heterozygosity      Max % max heterozygosity              0.10


</code></pre>
<p><img alt="Pipeline-overview" src="../img/wi-gatk-nf-flow.png" /></p>
<h2 id="software_requirements">Software Requirements<a class="headerlink" href="#software_requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>The latest update requires Nextflow version 20.0+. On QUEST, you can access this version by loading the <code>nf20</code> conda environment prior to running the pipeline command:</li>
</ul>
<pre><code>module load python/anaconda3.6
source activate /projects/b1059/software/conda_envs/nf20_env
</code></pre>
<p>Alternatively you can update Nextflow by running:</p>
<pre><code>nextflow self-update
</code></pre>
<ul>
<li>This pipeline also uses a docker image <a href="https://hub.docker.com/r/andersenlab/gatk4/">andersenlab/gatk4</a> to manage software and reproducibility. To access this docker image, first load the <code>singularity</code> module on QUEST.</li>
</ul>
<pre><code>module load singularity
</code></pre>
<h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h1>
<h2 id="profiles">Profiles<a class="headerlink" href="#profiles" title="Permanent link">&para;</a></h2>
<p>The <code>nextflow.config</code> file included with this pipeline contains three profiles. These set up the environment for testing local development, testing on Quest, and running the pipeline on Quest.</p>
<ul>
<li><code>local</code> - Used for local development. Uses the docker container.</li>
<li><code>quest_debug</code> - Runs a small subset of available test data. Should complete within a couple of hours. For testing/diagnosing issues on Quest.</li>
<li><code>quest</code> - Runs the entire dataset.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you forget to add a <code>-profile</code>, the <code>quest</code> profile will be chosen as default</p>
</div>
<h2 id="running_the_pipeline_locally">Running the pipeline locally<a class="headerlink" href="#running_the_pipeline_locally" title="Permanent link">&para;</a></h2>
<p>When running locally, the pipeline will run using the <code>andersenlab/gatk4</code> docker image. You must have docker installed.</p>
<pre><code>nextflow run main.nf -profile local -resume
</code></pre>
<h2 id="debugging_the_pipeline_on_quest">Debugging the pipeline on Quest<a class="headerlink" href="#debugging_the_pipeline_on_quest" title="Permanent link">&para;</a></h2>
<p>When running on Quest, you should first run the quest debug profile. The Quest debug profile will use a test dataset and sample sheet which runs much faster and will encounter errors much sooner should they need to be fixed. If the debug dataset runs to completion it is likely that the full dataset will as well.</p>
<pre><code>nextflow run main.nf -profile quest_debug -resume
</code></pre>
<h2 id="running_the_pipeline_on_quest">Running the pipeline on Quest<a class="headerlink" href="#running_the_pipeline_on_quest" title="Permanent link">&para;</a></h2>
<p>The pipeline can be run on Quest using the following command:</p>
<pre><code>nextflow run main.nf -profile quest --sample_sheet &lt;path_to_sheet&gt; -resume
</code></pre>
<h1 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h1>
<p>Most configuration is handled using the <code>-profile</code> flag and <code>nextflow.config</code>; If you want to fine tune things you can use the options below.</p>
<h2 id="--sample_sheet">--sample_sheet<a class="headerlink" href="#--sample_sheet" title="Permanent link">&para;</a></h2>
<p>The sample sheet is the output of <code>5.low_map_cov_for_seq_sheet.Rmd</code> after running <code>alignment-nf</code> (soon to be integrated into alignment-nf). The sample sheet contains 5 columns as detailed below:</p>
<table>
<thead>
<tr>
<th align="left">strain</th>
<th align="left">bam</th>
<th align="left">bai</th>
<th align="left">coverage</th>
<th align="left">percent_mapped</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">AB1</td>
<td align="left">AB1.bam</td>
<td align="left">AB1.bam.bai</td>
<td align="left">64</td>
<td align="left">99.4</td>
</tr>
<tr>
<td align="left">AB4</td>
<td align="left">AB4.bam</td>
<td align="left">AB4.bam.bai</td>
<td align="left">52</td>
<td align="left">99.2</td>
</tr>
<tr>
<td align="left">BRC20067</td>
<td align="left">BRC20067.bam</td>
<td align="left">BRC20067.bam.bai</td>
<td align="left">30</td>
<td align="left">92.5</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is essential that you always use the pipelines and scripts to generate this sample sheet and <strong>NEVER</strong> manually. There are lots of strains and we want to make sure the entire process can be reproduced.</p>
</div>
<h3 id="--bam_location_optional">--bam_location (optional)<a class="headerlink" href="#--bam_location_optional" title="Permanent link">&para;</a></h3>
<p>Path to directory holding all the alignment files for strains in the analysis. Defaults to <code>/projects/b1059/data/{species}/WI/alignments/</code></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Remember to move your bam files output from <a href="github.com/andersenlab/alignment-nf">alignment-nf</a> to this location prior to running <code>wi-gatk</code>. In <strong>most</strong> cases, you will want to run <code>wi-gatk</code> on all samples, new and old combined.</p>
</div>
<h3 id="--species_optional">--species (optional)<a class="headerlink" href="#--species_optional" title="Permanent link">&para;</a></h3>
<p><strong>default</strong> = c_elegans</p>
<p>Options: c_elegans, c_briggsae, or c_tropicalis</p>
<h3 id="--project_optional">--project (optional)<a class="headerlink" href="#--project_optional" title="Permanent link">&para;</a></h3>
<p><strong>default</strong> = PRJNA13758</p>
<p>WormBase project ID for selected species. Choose from some examples <a href="https://github.com/AndersenLab/genomes-nf/blob/master/bin/project_species.tsv">here</a></p>
<h3 id="--ws_build_optional">--ws_build (optional)<a class="headerlink" href="#--ws_build_optional" title="Permanent link">&para;</a></h3>
<p><strong>default</strong> = WS276</p>
<p>WormBase version to use for reference genome.</p>
<h3 id="--reference_optional">--reference (optional)<a class="headerlink" href="#--reference_optional" title="Permanent link">&para;</a></h3>
<p>A fasta reference indexed with BWA. On Quest, the reference is available here:</p>
<pre><code>/projects/b1059/data/c_elegans/genomes/PRJNA13758/WS276/c_elegans.PRJNA13758.WS276.genome.fa.gz
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If running on QUEST, instead of changing the <code>reference</code> parameter, opt to change the <code>species</code>, <code>project</code>, and <code>ws_build</code> for other species like c_briggsae (and then the reference will change automatically) </p>
</div>
<h3 id="--mito_name_optional">--mito_name (optional)<a class="headerlink" href="#--mito_name_optional" title="Permanent link">&para;</a></h3>
<p>Name of contig to skip het polarization. Might need to change for other species besides c_elegans if the mitochondria contig is named differently. Defaults to <code>MtDNA</code>.</p>
<h3 id="--output_optional">--output (optional)<a class="headerlink" href="#--output_optional" title="Permanent link">&para;</a></h3>
<p>A directory in which to output results. By default it will be <code>WI-YYYYMMDD</code> where YYYYMMDD is todays date.</p>
<h1 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h1>
<p>The final output directory looks like this:</p>
<pre><code>
├── variation
│   ├── *.hard-filter.vcf.gz
│   ├── *.hard-filter.vcf.tbi
│   ├── *.hard-filter.stats.txt
│   ├── *.hard-filter.filter_stats.txt
│   ├── *.soft-filter.vcf.gz
│   ├── *.soft-filter.vcf.tbi
│   ├── *.soft-filter.stats.txt
│   └── *.soft-filter.filter_stats.txt
└── report
    ├── multiqc.html
    └── multiqc_data
        └── multiqc_*.json
   
</code></pre>
<h1 id="data_storage">Data Storage<a class="headerlink" href="#data_storage" title="Permanent link">&para;</a></h1>
<h2 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">&para;</a></h2>
<p>The <code>hard-filter.vcf</code> is the input for both the <a href="https://github.com/AndersenLab/concordance-nf"><code>concordance-nf</code></a> pipeline and the <a href="https://github.com/AndersenLab/post-gatk-nf"><code>post-gatk-nf</code></a> pipeline. Once both pipelines have been completed successfully, the hard and soft filter vcf and index files (everything output in the <code>variation</code> folder) can be moved to <code>/projects/b1059/data/{species}/WI/variation/{date}/vcf</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pipeline-postGATK/" class="btn btn-neutral float-right" title="post-gatk-nf">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../pipeline-concordance/" class="btn btn-neutral" title="concordance-nf"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Andersenlab/dry-guide/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../pipeline-concordance/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pipeline-postGATK/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../js/version-select.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
